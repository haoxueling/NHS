{% extends 'navbar.html' %}

{% block navbar_links %}
<li class="nav-item">
  <a class="nav-link active" aria-current="page" href="/user_type_distribution">
    <i class="bi bi-pie-chart-fill me-1"></i>Distribution
  </a>
</li>
<li class="nav-item">
  <a class="nav-link active" aria-current="page" href="qa_dashboard">
    <i class="bi bi-question-circle-fill me-1"></i>Q&A
  </a>
</li>
{% endblock %}

{% block main_nav_item %}
<li class="nav-item">
  <a class="nav-link" href="/doctor">
    <i class="bi bi-person-circle me-1"></i>Doctor
  </a>
</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 bg-light py-4">
            <h4>Clinical Dashboard</h4>

            <div class="mb-3">
                <label for="tumorType" class="form-label">Tumor Type</label>
                <select id="tumorType" class="form-select">
                    <option value="all" selected>All Tumor Types</option>
                    <option value="Colorectal Team">Colorectal Team</option>
                    <option value="Stoma Care Team">Stoma Care Team</option>
                    <option value="Upper GI Team">Upper GI Team</option>
                    <option value="Haematology Team">Haematology Team</option>
                    <option value="Lung Team">Lung Team</option>
                    <option value="Breast Care Team">Breast Care Team</option>
                    <option value="sSkin Team">Skin Team</option>
                    <option value="Head and Neck Team">Head and Neck Team</option>
                    <option value="Gynaecology Team">Gynaecology Team</option>
                    <option value="Chemotherapy Team">Chemotherapy Team</option>
                </select>
            </div>

            <div class="mb-3">
                <input type="text" id="patientSearch" class="form-control" placeholder="Search by Patient Name">
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 py-4">
            <h2 class="mb-4">Screening results</h2>

            <div class="table-responsive">
                <table class="table table-bordered text-center align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Patient</th>
                            <!--<th>Tumor Type</th>-->
                            <th>Physical Activity Score </th>
                            <th> Level</th>
                            <th>Psychological Wellbeing Score</th>
                            <th>Level</th>
                            <th>Nutrition Score</th>
                            <th>Level</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in patients %}
                        <tr data-tumor-type="{{ p.user.tumor_type }}">
                            <td>{{ p.id }}</td>
                            <td class="patient-name">{{ p.user.name }}</td>
                            <!-- ✅ 新增：显示患者的肿瘤类型 -->
                            <!--<td>{{ p.user.tumor_type }}</td>-->
                            <td>{{ p.dasi_score }}</td>
                            <td>{{ p.dasi_level }}</td>
                            <td>{{ p.phq4_score }}</td>
                            <td>{{ p.phq4_level }}</td>
                            <td>{{ p.pgsga_score }}</td>
                            <td>{{ p.pgsga_level }}</td>
                            <td><a class="btn btn-outline-primary btn-sm"
                                    href="/doctor/question-info?id={{ p.id }}&name={{ p.user.name|urlencode }}" >View</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 引入 Bootstrap JS 依赖 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tumorTypeSelect = document.getElementById('tumorType');
        const patientSearchInput = document.getElementById('patientSearch');
        const tableRows = document.querySelectorAll('tbody tr');

        function applyFilters() {
            const selectedTumorType = tumorTypeSelect.value;
            const searchTerm = patientSearchInput.value.toLowerCase();

            tableRows.forEach(row => {
                const rowTumorType = row.getAttribute('data-tumor-type');
                const patientName = row.querySelector('.patient-name').textContent.toLowerCase();

                const matchesTumorType = selectedTumorType === 'all' || rowTumorType === selectedTumorType;
                const matchesSearchTerm = patientName.includes(searchTerm);

                if (matchesTumorType && matchesSearchTerm) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // 监听下拉菜单和搜索框的变化
        tumorTypeSelect.addEventListener('change', applyFilters);
        patientSearchInput.addEventListener('input', applyFilters);
    });
</script>
{% endblock %}
