<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 1. Bootstrap CSSï¼ˆç¡®ä¿å¯¼èˆªæ æ ·å¼ï¼‰ -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
    crossorigin="anonymous"
  >

  <!-- 2. Bootstrap å›¾æ ‡ï¼ˆå¯é€‰ï¼Œç”¨äºå¤´åƒï¼‰ -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.min.css"
    rel="stylesheet"
  >

  <title>Questionnaire System</title>

  <style>
    /* ğŸ”µ æ ¸å¿ƒï¼šä¸‹æ‹‰èœå•æ ·å¼ä¸äº¤äº’ */
    .dropdown-menu {
      display: none;          /* åˆå§‹éšè— */
      position: absolute;     /* è„±ç¦»æ–‡æ¡£æµ */
      top: 100%;              /* ä½äºæŒ‰é’®æ­£ä¸‹æ–¹ */
      right: 0;               /* å³å¯¹é½ */
      z-index: 9999;          /* å¼ºåˆ¶ç½®é¡¶ï¼Œé¿å…è¢«è¦†ç›– */
      min-width: 120px;       /* æœ€å°å®½åº¦ */
      padding: 8px 0;         /* å†…è¾¹è· */
      margin-top: 4px;        /* ä¸æŒ‰é’®é—´è· */
      background-color: #fff; /* èƒŒæ™¯è‰² */
      border: 1px solid #dee2e6; /* è¾¹æ¡† */
      border-radius: 4px;     /* åœ†è§’ */
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); /* é˜´å½±å¢å¼ºå±‚æ¬¡æ„Ÿ */
    }
    .dropdown.show .dropdown-menu {
      display: block;         /* ç‚¹å‡»åæ˜¾ç¤º */
    }

    /* ğŸ”µ ä¿®å¤å¯¼èˆªæ æŠ˜å æ—¶çš„æº¢å‡ºé—®é¢˜ */
    .navbar-collapse {
      overflow: visible !important;
    }
  </style>
</head>
<body>

  <!-- ğŸ”µ å¯¼èˆªæ ä¸»ä½“ -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
      <!-- å“ç‰Œ/Logo -->
      <a class="navbar-brand" >
        <i class="bi bi-clipboard-check-fill me-2"></i>Questionnaire System
      </a>

      <!-- ç§»åŠ¨ç«¯æŠ˜å æŒ‰é’®ï¼ˆä¾èµ–Bootstrap JSï¼Œè‹¥éœ€åŠŸèƒ½éœ€ç¡®ä¿åŠ è½½ï¼‰ -->
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- å¯¼èˆªèœå• -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          {% block main_nav_item %}
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/user">
              <i class="bi bi-file-text-fill me-1"></i>Questionnaire
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/user/my_questions">
              <i class="bi bi-file-text-fill me-1"></i>Q&A
            </a>
          </li>
          {% endblock %}
          {% block navbar_links %}{% endblock %}
        </ul>

        <!-- å³ä¾§ç”¨æˆ·ä¸‹æ‹‰åŒºåŸŸ -->
        <div class="d-flex align-items-center">
          <div class="dropdown" id="userDropdown">
            <!-- ä¸‹æ‹‰è§¦å‘æŒ‰é’® -->
            <button
              class="btn btn-light dropdown-toggle"
              type="button"
              id="dropdownTrigger"
            >
              <i class="bi bi-person-circle"></i> {{ username }}
            </button>
            <!-- ä¸‹æ‹‰èœå• -->
            <ul class="dropdown-menu dropdown-menu-end">

              {% if user_role == 'user' %}
              <li><a class="dropdown-item" href="{{ url_for('user.user_profile') }}">
                <i class="bi bi-person me-2"></i>Profile
              </a></li>
              {% elif user_role == 'doctor' %}
              <li><a class="dropdown-item" href="{{ url_for('doctor_ui.doctor_profile') }}">
                <i class="bi bi-person me-2"></i>Profile
              </a></li>
              {% endif %}
              <li><a class="dropdown-item text-danger" href="/logout">
                <i class="bi bi-box-arrow-right me-2"></i>Logout
              </a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- 3. Bootstrap JSï¼ˆå¯é€‰ï¼Œè‹¥éœ€æŠ˜å ç­‰åŠŸèƒ½ï¼›ä¸‹æ‹‰é€»è¾‘å·²åŸç”Ÿå®ç°ï¼‰ -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"
  ></script>

  <!-- 4. åŸç”ŸJSå®ç°ä¸‹æ‹‰é€»è¾‘ï¼ˆ100%ç‹¬ç«‹ï¼Œç¡®ä¿å¿…ç°ç”Ÿæ•ˆï¼‰ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dropdown = document.getElementById('userDropdown');
      const trigger = document.getElementById('dropdownTrigger');

      // ğŸ”¹ ç‚¹å‡»æŒ‰é’®ï¼šåˆ‡æ¢ä¸‹æ‹‰çŠ¶æ€
      trigger.addEventListener('click', (e) => {
        e.stopPropagation(); // é˜»æ­¢å†’æ³¡ï¼Œé¿å…è§¦å‘å¤–éƒ¨ç‚¹å‡»äº‹ä»¶
        dropdown.classList.toggle('show');
      });

      // ğŸ”¹ ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸï¼šå…³é—­ä¸‹æ‹‰
      document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
          dropdown.classList.remove('show');
        }
      });

      // ğŸ”¹ æŒ‰ESCé”®ï¼šå…³é—­ä¸‹æ‹‰
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          dropdown.classList.remove('show');
        }
      });

      console.log('âœ… å¯¼èˆªæ ä¸‹æ‹‰åŠŸèƒ½åˆå§‹åŒ–æˆåŠŸï¼ˆçº¯åŸç”ŸJSå®ç°ï¼‰');
    });
  </script>

  {% block content %}{% endblock %}
</body>
</html>