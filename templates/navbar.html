<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 1. Bootstrap CSS（确保导航栏样式） -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
    crossorigin="anonymous"
  >

  <!-- 2. Bootstrap 图标（可选，用于头像） -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.min.css"
    rel="stylesheet"
  >

  <title>Questionnaire System</title>

  <style>
    /* 🔵 核心：下拉菜单样式与交互 */
    .dropdown-menu {
      display: none;          /* 初始隐藏 */
      position: absolute;     /* 脱离文档流 */
      top: 100%;              /* 位于按钮正下方 */
      right: 0;               /* 右对齐 */
      z-index: 9999;          /* 强制置顶，避免被覆盖 */
      min-width: 120px;       /* 最小宽度 */
      padding: 8px 0;         /* 内边距 */
      margin-top: 4px;        /* 与按钮间距 */
      background-color: #fff; /* 背景色 */
      border: 1px solid #dee2e6; /* 边框 */
      border-radius: 4px;     /* 圆角 */
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); /* 阴影增强层次感 */
    }
    .dropdown.show .dropdown-menu {
      display: block;         /* 点击后显示 */
    }

    /* 🔵 修复导航栏折叠时的溢出问题 */
    .navbar-collapse {
      overflow: visible !important;
    }
  </style>
</head>
<body>

  <!-- 🔵 导航栏主体 -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
      <!-- 品牌/Logo -->
      <a class="navbar-brand" >
        <i class="bi bi-clipboard-check-fill me-2"></i>Questionnaire System
      </a>

      <!-- 移动端折叠按钮（依赖Bootstrap JS，若需功能需确保加载） -->
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- 导航菜单 -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          {% block main_nav_item %}
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/user">
              <i class="bi bi-file-text-fill me-1"></i>Questionnaire
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/user/my_questions">
              <i class="bi bi-file-text-fill me-1"></i>Q&A
            </a>
          </li>
          {% endblock %}
          {% block navbar_links %}{% endblock %}
        </ul>

        <!-- 右侧用户下拉区域 -->
        <div class="d-flex align-items-center">
          <div class="dropdown" id="userDropdown">
            <!-- 下拉触发按钮 -->
            <button
              class="btn btn-light dropdown-toggle"
              type="button"
              id="dropdownTrigger"
            >
              <i class="bi bi-person-circle"></i> {{ username }}
            </button>
            <!-- 下拉菜单 -->
            <ul class="dropdown-menu dropdown-menu-end">

              {% if user_role == 'user' %}
              <li><a class="dropdown-item" href="{{ url_for('user.user_profile') }}">
                <i class="bi bi-person me-2"></i>Profile
              </a></li>
              {% elif user_role == 'doctor' %}
              <li><a class="dropdown-item" href="{{ url_for('doctor_ui.doctor_profile') }}">
                <i class="bi bi-person me-2"></i>Profile
              </a></li>
              {% endif %}
              <li><a class="dropdown-item text-danger" href="/logout">
                <i class="bi bi-box-arrow-right me-2"></i>Logout
              </a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- 3. Bootstrap JS（可选，若需折叠等功能；下拉逻辑已原生实现） -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"
  ></script>

  <!-- 4. 原生JS实现下拉逻辑（100%独立，确保必现生效） -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dropdown = document.getElementById('userDropdown');
      const trigger = document.getElementById('dropdownTrigger');

      // 🔹 点击按钮：切换下拉状态
      trigger.addEventListener('click', (e) => {
        e.stopPropagation(); // 阻止冒泡，避免触发外部点击事件
        dropdown.classList.toggle('show');
      });

      // 🔹 点击页面其他区域：关闭下拉
      document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
          dropdown.classList.remove('show');
        }
      });

      // 🔹 按ESC键：关闭下拉
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          dropdown.classList.remove('show');
        }
      });

      console.log('✅ 导航栏下拉功能初始化成功（纯原生JS实现）');
    });
  </script>

  {% block content %}{% endblock %}
</body>
</html>